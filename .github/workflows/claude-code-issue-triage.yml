name: Claude Code - Issue è‡ªåŠ¨åˆ†è¯Š

on:
  issues:
    types: [opened, reopened]

permissions:
  issues: write
  contents: read

jobs:
  triage:
    runs-on: ubuntu-latest

    steps:
      - name: æ£€å‡ºä»£ç 
        uses: actions/checkout@v4

      - name: Claude è‡ªåŠ¨åˆ†è¯Š
        id: triage_issue
        uses: anthropics/claude-code-action@v1
        env:
          # æ”¯æŒè‡ªå®šä¹‰ Anthropic API Base URL
          ANTHROPIC_BASE_URL: ${{ secrets.ANTHROPIC_BASE_URL }}
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}

          prompt: |
            ä½ æ˜¯è¿™ä¸ªä»“åº“çš„ Issue åˆ†è¯Šæœºå™¨äººã€‚

            è¯·åˆ†æå½“å‰ issueï¼ˆ#${{ github.event.issue.number }}ï¼‰ï¼š

            1. **åˆ†ç±»**ï¼šåˆ¤æ–­ç±»å‹ï¼ˆbug / enhancement / documentation / questionï¼‰
            2. **ä¼˜å…ˆçº§**ï¼šè¯„ä¼°å½±å“èŒƒå›´ï¼ˆpriority-high / priority-medium / priority-lowï¼‰
            3. **æ¨¡å—**ï¼šè¯†åˆ«æ¶‰åŠçš„æ¨¡å—ï¼ˆå¯èƒ½çš„æ ‡ç­¾ï¼šui-consistency, tech-debt, performance, type-safetyï¼‰
            4. **å¤ç°ä¿¡æ¯**ï¼šæ£€æŸ¥æ˜¯å¦æä¾›äº†è¶³å¤Ÿçš„å¤ç°æ­¥éª¤ï¼Œå¦‚æœç¼ºå¤±ï¼Œåˆ—å‡ºéœ€è¦è¡¥å……çš„ä¿¡æ¯
            5. **å»ºè®®æ ‡ç­¾**ï¼šåœ¨å›å¤æœ«å°¾ç”¨è¿™ä¸ªæ ¼å¼è¾“å‡ºï¼š
               ```
               å»ºè®®æ ‡ç­¾: bug, priority-high, ui-consistency
               ```

            ç”Ÿæˆä½ çš„åˆ†ææŠ¥å‘Šã€‚

            æ³¨æ„ï¼šä½ åªèƒ½**å»ºè®®**æ ‡ç­¾ï¼Œä¸èƒ½ç›´æ¥æ·»åŠ æ ‡ç­¾ã€‚

          claude_args: "--max-turns 3"

      - name: å¤„ç†åˆ†è¯Šå¤±è´¥
        if: failure()
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const issueNumber = context.payload.issue.number;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issueNumber,
              body: [
                'âŒ **Issue è‡ªåŠ¨åˆ†è¯Šå¤±è´¥**',
                '',
                'æŠ±æ­‰ï¼Œåˆ†ææ­¤ issue æ—¶é‡åˆ°äº†é—®é¢˜ã€‚',
                '',
                '**å¯èƒ½çš„åŸå› **ï¼š',
                '- Issue å†…å®¹è¿‡äºå¤æ‚æˆ–æ ¼å¼å¼‚å¸¸',
                '- API è°ƒç”¨å¤±è´¥',
                '- æƒé™ä¸è¶³',
                '',
                '**å»ºè®®**ï¼š',
                '- è¯·æŸ¥çœ‹ [Actions è¿è¡Œæ—¥å¿—](' + context.payload.repository.html_url + '/actions/runs/' + context.runId + ') äº†è§£è¯¦æƒ…',
                '- äººå·¥æ·»åŠ åˆé€‚çš„æ ‡ç­¾',
                '',
                '---',
                'ğŸ¤– GitHub Actions è‡ªåŠ¨é€šçŸ¥'
              ].join('\n')
            });

      # å¦‚æœéœ€è¦è‡ªåŠ¨æ‰“æ ‡ç­¾ï¼Œå¯ä»¥æ·»åŠ åç»­æ­¥éª¤è§£æ Claude çš„è¾“å‡º
      # ä½†è¿™éœ€è¦é¢å¤–çš„è„šæœ¬é€»è¾‘ï¼Œè¿™é‡Œæš‚æ—¶åªè®© Claude å»ºè®®
